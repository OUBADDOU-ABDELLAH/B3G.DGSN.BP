§Ë
dC:\Users\ITAdministrator\source\repos\B3G.DGSN\B3G.DGSN.SERVICE\ImplemetInterface\DGSNFuncService.cs
	namespace 	
B3G
 
. 
DGSN 
. 
SERVICE 
. 
ImplemetInterface ,
{ 
public 

class 
DGSNFuncService  
:! "
	IDGSNFunc# ,
{ 
ISessionService 
_service  
;  !
private 
readonly 
IConfiguration '
_config( /
;/ 0
public 
DGSNFuncService 
( 
ISessionService .
service/ 6
,6 7
IConfiguration8 F
configG M
)M N
{ 	
_service 
= 
service 
; 
_config 
= 
config 
; 
} 	
public 
string 
RedirectUrl !
(! "
string" (
code) -
,- .
string/ 5
state6 ;
,; <
string= C
	codeErrorD M
,M N
stringO U
ErrorDescriptionV f
)f g
{ 	
string 
erreur 
= 
$str 
; 
if 
( 
state 
!= 
null 
) 
{ 
if   
(   
!   
_service   
.   
IsSessionExist   ,
(  , -
state  - 2
)  2 3
)  3 4
{!! 
return"" 
erreur"" !
=""" #
$str""$ W
;""W X
}## 
}$$ 
if&& 
(&& 
!&& 
string&& 
.&& 
IsNullOrEmpty&& %
(&&% &
	codeError&&& /
)&&/ 0
||&&1 3
!&&4 5
string&&5 ;
.&&; <
IsNullOrEmpty&&< I
(&&I J
ErrorDescription&&J Z
)&&Z [
)&&[ \
{'' 
return(( 
erreur(( 
=(( 
ErrorDescription((  0
;((0 1
})) 
if++ 
(++ 
!++ 
string++ 
.++ 
IsNullOrEmpty++ %
(++% &
code++& *
)++* +
)+++ ,
{,, 
return.. 
$str..  
+..! "
code..# '
+..( )
$str..* 5
+..6 7
state..8 =
;..= >
}// 
else00 
{11 
erreur22 
=22 
$str22 S
;22S T
return33 
erreur33 
;33 
}44 
}66 	
public77 
string77 
GetToken77 
(77 
string77 %
code77& *
)77* +
{88 	
OpenIdToken99 
token99 
=99 
null99  $
;99$ %
HttpClientHandler:: 
handler:: %
=::& '
new::( +
HttpClientHandler::, =
(::= >
)::> ?
;::? @

HttpClient;; 
client;; 
=;; 
new;;  #

HttpClient;;$ .
(;;. /
handler;;/ 6
);;6 7
;;;7 8
string== 
secret== 
=== 
	GetSecret== %
(==% &
)==& '
;==' (
string?? 
idClient?? 
=?? 
$str?? D
;??D E
stringAA 

basicTokenAA 
=AA 
idClientAA  (
+AA) *
$strAA+ .
+AA/ 0
secretAA1 7
;AA7 8
varBB 

basicBytesBB 
=BB 
EncodingBB %
.BB% &
UTF8BB& *
.BB* +
GetBytesBB+ 3
(BB3 4

basicTokenBB4 >
)BB> ?
;BB? @
stringCC 
basicCC 
=CC 
ConvertCC "
.CC" #
ToBase64StringCC# 1
(CC1 2

basicBytesCC2 <
)CC< =
;CC= >
clientDD 
.DD !
DefaultRequestHeadersDD (
.DD( )
AuthorizationDD) 6
=DD7 8
newDD9 <
SystemDD= C
.DDC D
NetDDD G
.DDG H
HttpDDH L
.DDL M
HeadersDDM T
.DDT U%
AuthenticationHeaderValueDDU n
(DDn o
$strDDo v
,DDv w
basicDDx }
)DD} ~
;DD~ 
clientFF 
.FF !
DefaultRequestHeadersFF (
.FF( )
AcceptFF) /
.FF/ 0
AddFF0 3
(FF3 4
newFF4 7
SystemFF8 >
.FF> ?
NetFF? B
.FFB C
HttpFFC G
.FFG H
HeadersFFH O
.FFO P+
MediaTypeWithQualityHeaderValueFFP o
(FFo p
$strFFp u
)FFu v
)FFv w
;FFw x
stringHH 
exchangeParametersHH %
=HH& '
$strHH( *
;HH* +
exchangeParametersII 
+=II !
HttpUtilityII" -
.II- .
	UrlEncodeII. 7
(II7 8
$strII8 D
)IID E
+IIF G
$strIIH K
+IIL M
HttpUtilityIIN Y
.IIY Z
	UrlEncodeIIZ c
(IIc d
$strIId x
)IIx y
;IIy z
exchangeParametersJJ 
+=JJ !
$strJJ" %
;JJ% &
exchangeParametersKK 
+=KK !
HttpUtilityKK" -
.KK- .
	UrlEncodeKK. 7
(KK7 8
$strKK8 >
)KK> ?
+KK@ A
$strKKB E
+KKF G
HttpUtilityKKH S
.KKS T
	UrlEncodeKKT ]
(KK] ^
codeKK^ b
)KKb c
;KKc d
exchangeParametersLL 
+=LL !
$strLL" %
;LL% &
exchangeParametersMM 
+=MM !
HttpUtilityMM" -
.MM- .
	UrlEncodeMM. 7
(MM7 8
$strMM8 G
)MMG H
+MMI J
$strMMK N
+MMO P
HttpUtilityMMQ \
.MM\ ]
	UrlEncodeMM] f
(MMf g
secretMMg m
)MMm n
;MMn o
exchangeParametersNN 
+=NN !
$strNN" %
;NN% &
exchangeParametersOO 
+=OO !
HttpUtilityOO" -
.OO- .
	UrlEncodeOO. 7
(OO7 8
$strOO8 C
)OOC D
+OOE F
$strOOG J
+OOK L
HttpUtilityOOM X
.OOX Y
	UrlEncodeOOY b
(OOb c
idClientOOc k
)OOk l
;OOl m
HttpRequestMessagePP 
requestPP &
=PP' (
newPP) ,
HttpRequestMessagePP- ?
(PP? @

HttpMethodPP@ J
.PPJ K
PostPPK O
,PPO P
$strPPQ {
)PP{ |
;PP| }
requestQQ 
.QQ 
ContentQQ 
=QQ 
newQQ !
StringContentQQ" /
(QQ/ 0
exchangeParametersQQ0 B
,QQB C
SystemQQD J
.QQJ K
TextQQK O
.QQO P
EncodingQQP X
.QQX Y
UTF8QQY ]
,QQ] ^
$str	QQ_ Ç
)
QQÇ É
;
QQÉ Ñ
HttpResponseMessageSS 
responseSS  (
=SS) *
clientSS+ 1
.SS1 2
	SendAsyncSS2 ;
(SS; <
requestSS< C
)SSC D
.SSD E
ResultSSE K
;SSK L
ifTT 
(TT 
responseTT 
.TT 

StatusCodeTT #
!=TT$ &
SystemTT' -
.TT- .
NetTT. 1
.TT1 2
HttpStatusCodeTT2 @
.TT@ A
OKTTA C
)TTC D
{UU 
returnVV 
nullVV 
;VV 
}WW 
usingYY 
(YY 
HttpContentYY 
contentYY &
=YY' (
responseYY) 1
.YY1 2
ContentYY2 9
)YY9 :
{ZZ 
var[[ 
jsonResp[[ 
=[[ 
content[[ &
.[[& '
ReadAsStringAsync[[' 8
([[8 9
)[[9 :
.[[: ;
Result[[; A
;[[A B
if\\ 
(\\ 
string\\ 
.\\ 
IsNullOrEmpty\\ (
(\\( )
jsonResp\\) 1
)\\1 2
)\\2 3
{]] 
return^^ 
null^^ 
;^^  
}__ 
else`` 
{aa 
returnbb 
jsonRespbb #
+bb$ %
$strbb& 7
+bb8 9
secretbb: @
;bb@ A
}cc 
trydd 
{ee 
tokenff 
=ff 
JsonConvertff '
.ff' (
DeserializeObjectff( 9
<ff9 :
OpenIdTokenff: E
>ffE F
(ffF G
jsonRespffG O
)ffO P
;ffP Q
}gg 
catchhh 
(hh 
	Exceptionhh  
e5hh! #
)hh# $
{ii 
}kk 
}mm 
}oo 	
publicss 
staticss 
bytess 
[ss 
]ss 
Base64UrlDecodess ,
(ss, -
stringss- 3
inputss4 9
)ss9 :
{tt 	
stringuu 
paddeduu 
=uu 
inputuu !
+uu" #
newuu$ '
stringuu( .
(uu. /
$charuu/ 2
,uu2 3
(uu4 5
$numuu5 6
-uu7 8
inputuu9 >
.uu> ?
Lengthuu? E
%uuF G
$numuuH I
)uuI J
%uuK L
$numuuM N
)uuN O
;uuO P
stringvv 
base64vv 
=vv 
paddedvv "
.vv" #
Replacevv# *
(vv* +
$charvv+ .
,vv. /
$charvv0 3
)vv3 4
.vv4 5
Replacevv5 <
(vv< =
$charvv= @
,vv@ A
$charvvB E
)vvE F
;vvF G
returnww 
Convertww 
.ww 
FromBase64Stringww +
(ww+ ,
base64ww, 2
)ww2 3
;ww3 4
}xx 	
public 
string 
VerifierSignature '
(' (
string( .
token/ 4
,4 5
string5 ;
JwksURL< C
)C D
{
ÄÄ 	
string
ÅÅ 
jwksURL
ÅÅ 
=
ÅÅ 
JwksURL
ÅÅ $
;
ÅÅ$ %
RSAJsonWebKeys
ÇÇ 
key1
ÇÇ 
=
ÇÇ  !
new
ÇÇ" %
(
ÇÇ% &
)
ÇÇ& '
{
ÇÇ( )
}
ÇÇ* +
;
ÇÇ+ ,
string
ÉÉ 
error
ÉÉ 
=
ÉÉ 
null
ÉÉ 
;
ÉÉ  
RSAJsonWebKeys
ÑÑ 
.
ÑÑ 
GetIssuerKeys
ÑÑ (
(
ÑÑ( )
jwksURL
ÑÑ) 0
,
ÑÑ0 1
ref
ÑÑ2 5
key1
ÑÑ6 :
,
ÑÑ: ;
ref
ÑÑ< ?
error
ÑÑ@ E
)
ÑÑE F
;
ÑÑF G
string
ÖÖ 
res
ÖÖ 
=
ÖÖ 
$str
ÖÖ 
;
ÖÖ 
string
áá 
[
áá 
]
áá 
parts
áá 
=
áá 
token
áá #
.
áá# $
Split
áá$ )
(
áá) *
$char
áá* -
)
áá- .
;
áá. /
var
ää 

jwtHandler
ää 
=
ää 
new
ää  %
JwtSecurityTokenHandler
ää! 8
(
ää8 9
)
ää9 :
;
ää: ;
var
ãã 
	parsedJwt
ãã 
=
ãã 

jwtHandler
ãã &
.
ãã& '
ReadJwtToken
ãã' 3
(
ãã3 4
token
ãã4 9
)
ãã9 :
;
ãã: ;
var
çç 

headerTest
çç 
=
çç 
	parsedJwt
çç &
.
çç& '
Header
çç' -
;
çç- .
	JWTHeader
èè 
	jwtHeader
èè 
=
èè  !
new
èè" %
	JWTHeader
èè& /
{
êê 
_typ
ëë 
=
ëë 

headerTest
ëë !
.
ëë! "
Typ
ëë" %
,
ëë% &
_alg
îî 
=
îî 

headerTest
îî !
.
îî! "
Alg
îî" %
,
îî% &
_kid
ïï 
=
ïï 

headerTest
ïï !
.
ïï! "
Kid
ïï" %
}
ññ 
;
ññ 
String
ßß 
	Signature
ßß 
=
ßß 
parts
ßß $
[
ßß$ %
$num
ßß% &
]
ßß& '
;
ßß' (
var
™™ 
	signature
™™ 
=
™™ 
Base64UrlDecode
™™ +
(
™™+ ,
	Signature
™™, 5
)
™™5 6
;
™™6 7
if
´´ 
(
´´ 
	jwtHeader
´´ 
==
´´ 
null
´´ !
)
´´! "
{
¨¨ 
res
≠≠ 
=
≠≠ 
res
≠≠ 
+
≠≠ 
$str
≠≠ .
;
≠≠. /
}
ØØ 
if
∞∞ 
(
∞∞ 
	jwtHeader
∞∞ 
.
∞∞ 
_typ
∞∞ 
!=
∞∞ !
$str
∞∞" '
)
∞∞' (
{
±± 
res
≤≤ 
=
≤≤ 
res
≤≤ 
+
≤≤ 
$str
≤≤ 3
;
≤≤3 4
}
¥¥ 
if
µµ 
(
µµ 
!
µµ 
	jwtHeader
µµ 
.
µµ 
_alg
µµ 
.
µµ  

StartsWith
µµ  *
(
µµ* +
$str
µµ+ /
)
µµ/ 0
)
µµ0 1
{
∂∂ 
res
∑∑ 
=
∑∑ 
res
∑∑ 
+
∑∑ 
$str
∑∑ <
;
∑∑< =
}
ππ 
var
ΩΩ 
keySet
ΩΩ 
=
ΩΩ 
key1
ΩΩ 
;
ΩΩ 
bool
ææ 
foundKey
ææ 
=
ææ 
false
ææ !
;
ææ! "
bool
øø 
algoOK
øø 
=
øø 
false
øø 
;
øø  
bool
¿¿ 
useOK
¿¿ 
=
¿¿ 
false
¿¿ 
;
¿¿ 
RSAJsonWebKey
¬¬ 
sigKey
¬¬  
=
¬¬! "
null
¬¬# '
;
¬¬' (
foreach
∆∆ 
(
∆∆ 
RSAJsonWebKey
∆∆ "
key
∆∆# &
in
∆∆' )
keySet
∆∆* 0
.
∆∆0 1
keys
∆∆1 5
)
∆∆5 6
{
«« 
if
   
(
   
key
   
.
   
_kid
   
==
   
	jwtHeader
    )
.
  ) *
_kid
  * .
)
  . /
{
ÀÀ 
foundKey
ÕÕ 
=
ÕÕ 
true
ÕÕ #
;
ÕÕ# $
algoOK
ŒŒ 
=
ŒŒ 
(
ŒŒ 
key
ŒŒ !
.
ŒŒ! "
_alg
ŒŒ" &
==
ŒŒ' )
	jwtHeader
ŒŒ* 3
.
ŒŒ3 4
_alg
ŒŒ4 8
)
ŒŒ8 9
;
ŒŒ9 :
useOK
œœ 
=
œœ 
key
œœ 
.
œœ  
_use
œœ  $
==
œœ% '
$str
œœ( -
;
œœ- .
sigKey
–– 
=
–– 
key
––  
;
––  !
}
”” 
}
‘‘ 
var
€€ 
cle
€€ 
=
€€ 
keySet
€€ 
.
€€ 
keys
€€ !
[
€€! "
$num
€€" #
]
€€# $
;
€€$ %
if
‹‹ 
(
‹‹ 
cle
‹‹ 
.
‹‹ 
_kid
‹‹ 
==
‹‹ 
	jwtHeader
‹‹ %
.
‹‹% &
_kid
‹‹& *
)
‹‹* +
{
›› 
foundKey
ﬁﬁ 
=
ﬁﬁ 
true
ﬁﬁ 
;
ﬁﬁ  
algoOK
ﬂﬂ 
=
ﬂﬂ 
(
ﬂﬂ 
cle
ﬂﬂ 
.
ﬂﬂ 
_alg
ﬂﬂ "
==
ﬂﬂ# %
	jwtHeader
ﬂﬂ& /
.
ﬂﬂ/ 0
_alg
ﬂﬂ0 4
)
ﬂﬂ4 5
;
ﬂﬂ5 6
useOK
‡‡ 
=
‡‡ 
cle
‡‡ 
.
‡‡ 
_use
‡‡  
==
‡‡! #
$str
‡‡$ )
;
‡‡) *
if
·· 
(
·· 
algoOK
·· 
&&
·· 
useOK
·· #
&&
··$ &
foundKey
··' /
)
··/ 0
{
‚‚ 
res
‰‰ 
=
‰‰ 
res
‰‰ 
+
‰‰ 
$str
‰‰  =
;
‰‰= >
}
ÁÁ 
}
ËË 
if
ÍÍ 
(
ÍÍ 
!
ÍÍ 
foundKey
ÍÍ 
)
ÍÍ 
{
ÎÎ 
res
ÏÏ 
=
ÏÏ 
$str
ÏÏ %
;
ÏÏ% &
}
ÓÓ 
if
 
(
 
!
 
algoOK
 
)
 
{
ÒÒ 
res
ÚÚ 
=
ÚÚ 
$str
ÚÚ #
;
ÚÚ# $
}
ÙÙ 
if
ˆˆ 
(
ˆˆ 
!
ˆˆ 
useOK
ˆˆ 
)
ˆˆ 
{
˜˜ 
res
¯¯ 
=
¯¯ 
$str
¯¯ "
;
¯¯" #
}
˙˙ 
HashAlgorithm
ÄÄ 
hashAlgo
ÄÄ "
=
ÄÄ# $
null
ÄÄ% )
;
ÄÄ) *
switch
ÅÅ 
(
ÅÅ 
	jwtHeader
ÅÅ 
.
ÅÅ 
_alg
ÅÅ "
.
ÅÅ" #
	Substring
ÅÅ# ,
(
ÅÅ, -
$num
ÅÅ- .
)
ÅÅ. /
)
ÅÅ/ 0
{
ÇÇ 
case
ÉÉ 
$str
ÉÉ 
:
ÉÉ 
hashAlgo
ÑÑ 
=
ÑÑ 
System
ÑÑ %
.
ÑÑ% &
Security
ÑÑ& .
.
ÑÑ. /
Cryptography
ÑÑ/ ;
.
ÑÑ; <
SHA256
ÑÑ< B
.
ÑÑB C
Create
ÑÑC I
(
ÑÑI J
)
ÑÑJ K
;
ÑÑK L
break
ÖÖ 
;
ÖÖ 
case
ÜÜ 
$str
ÜÜ 
:
ÜÜ 
hashAlgo
áá 
=
áá 
System
áá %
.
áá% &
Security
áá& .
.
áá. /
Cryptography
áá/ ;
.
áá; <
SHA384
áá< B
.
ááB C
Create
ááC I
(
ááI J
)
ááJ K
;
ááK L
break
ááM R
;
ááR S
case
àà 
$str
àà 
:
àà 
hashAlgo
ââ 
=
ââ 
System
ââ %
.
ââ% &
Security
ââ& .
.
ââ. /
Cryptography
ââ/ ;
.
ââ; <
SHA512
ââ< B
.
ââB C
Create
ââC I
(
ââI J
)
ââJ K
;
ââK L
break
ââM R
;
ââR S
default
ää 
:
ää 
break
ää 
;
ää 
}
ãã 
if
çç 
(
çç 
hashAlgo
çç 
==
çç 
null
çç  
)
çç  !
{
éé 
res
ëë 
=
ëë 
res
ëë 
+
ëë 
$str
ëë G
;
ëëG H
return
íí 
res
íí 
;
íí 
}
ìì 
var
ññ 
signed
ññ 
=
ññ 
parts
ññ 
[
ññ 
$num
ññ  
]
ññ  !
+
ññ" #
$str
ññ$ '
+
ññ( )
parts
ññ* /
[
ññ/ 0
$num
ññ0 1
]
ññ1 2
;
ññ2 3
var
óó 
dataToVerify
óó 
=
óó 
System
óó %
.
óó% &
Text
óó& *
.
óó* +
Encoding
óó+ 3
.
óó3 4
UTF8
óó4 8
.
óó8 9
GetBytes
óó9 A
(
óóA B
signed
óóB H
)
óóH I
;
óóI J
bool
ôô 
signatureOK
ôô 
=
ôô 
false
ôô $
;
ôô$ %
switch
öö 
(
öö 
sigKey
öö 
.
öö 
_kty
öö 
)
öö  
{
õõ 
case
úú 
$str
úú 
:
úú 
{
ùù 
var
üü 
modulus
üü #
=
üü$ %
Base64UrlDecode
üü& 5
(
üü5 6
sigKey
üü6 <
.
üü< =
_n
üü= ?
)
üü? @
;
üü@ A
var
†† 
exponent
†† $
=
††% &
Base64UrlDecode
††' 6
(
††6 7
sigKey
††7 =
.
††= >
_e
††> @
)
††@ A
;
††A B&
RSACryptoServiceProvider
°° 0
csp
°°1 4
=
°°5 6
new
°°7 :&
RSACryptoServiceProvider
°°; S
(
°°S T
)
°°T U
;
°°U V
RSAParameters
¢¢ %
	rsaParams
¢¢& /
=
¢¢0 1
new
¢¢2 5
RSAParameters
¢¢6 C
{
££ 
Exponent
§§ $
=
§§% &
exponent
§§' /
,
§§/ 0
Modulus
•• #
=
••$ %
modulus
••& -
}
¶¶ 
;
¶¶ 
csp
ßß 
.
ßß 
ImportParameters
ßß ,
(
ßß, -
	rsaParams
ßß- 6
)
ßß6 7
;
ßß7 8
signatureOK
©© #
=
©©$ %
csp
©©& )
.
©©) *

VerifyData
©©* 4
(
©©4 5
dataToVerify
©©5 A
,
©©A B
hashAlgo
©©C K
,
©©K L
	signature
©©M V
)
©©V W
;
©©W X
res
™™ 
=
™™ 
res
™™ !
+
™™" #
$str
™™$ t
+
™™u v
signatureOK™™w Ç
;™™Ç É
}
¨¨ 
break
≠≠ 
;
≠≠ 
default
ÆÆ 
:
ÆÆ 
res
ØØ 
=
ØØ 
res
ØØ 
+
ØØ 
$str
ØØ  N
;
ØØN O
break
±± 
;
±± 
}
≤≤ 
return
≥≥ 
res
≥≥ 
;
≥≥ 
}
µµ 	
public
ﬂﬂ 
string
ﬂﬂ 
SendUserToDGSN
ﬂﬂ $
(
ﬂﬂ$ %
)
ﬂﬂ% &
{
‡‡ 	

Dictionary
·· 
<
·· 
string
·· 
,
·· 
Session
·· &
>
··& '

m_Sessions
··( 2
=
··3 4
new
··5 8

Dictionary
··9 C
<
··C D
string
··D J
,
··J K
Session
··L S
>
··S T
(
··T U
)
··U V
;
··V W
string
‚‚ 
	serverURL
‚‚ 
=
‚‚ 
$str
‚‚ <
;
‚‚< =
string
„„ 
locales
„„ 
=
„„ 
$str
„„ !
;
„„! "
string
‰‰ 
scope
‰‰ 
=
‰‰ 
$str
‰‰ A
;
‰‰A B
string
ÂÂ 
client
ÂÂ 
=
ÂÂ 
$str
ÂÂ B
;
ÂÂB C
string
ÊÊ 
redirectURL
ÊÊ 
=
ÊÊ  
$str
ÊÊ! b
;
ÊÊb c
string
ÁÁ 
state
ÁÁ 
=
ÁÁ 
Guid
ÁÁ 
.
ÁÁ  
NewGuid
ÁÁ  '
(
ÁÁ' (
)
ÁÁ( )
.
ÁÁ) *
ToString
ÁÁ* 2
(
ÁÁ2 3
)
ÁÁ3 4
.
ÁÁ4 5
Replace
ÁÁ5 <
(
ÁÁ< =
$str
ÁÁ= @
,
ÁÁ@ A
$str
ÁÁB D
)
ÁÁD E
;
ÁÁE F
Session
ÈÈ 
session
ÈÈ 
=
ÈÈ 
new
ÈÈ !
(
ÈÈ! "
)
ÈÈ" #
{
ÈÈ$ %
}
ÈÈ% &
;
ÈÈ& '
session
ÍÍ 
.
ÍÍ 
state
ÍÍ 
=
ÍÍ 
state
ÍÍ !
;
ÍÍ! "

m_Sessions
ÎÎ 
[
ÎÎ 
state
ÎÎ 
]
ÎÎ 
=
ÎÎ 
session
ÎÎ  '
;
ÎÎ' (
_service
ÔÔ 
.
ÔÔ 

AddSession
ÔÔ 
(
ÔÔ  
session
ÔÔ  '
)
ÔÔ' (
;
ÔÔ( )
string
ÒÒ ,
openIDPerformAuthenticationURL
ÒÒ 1
=
ÒÒ2 3
	serverURL
ÒÒ4 =
;
ÒÒ= >,
openIDPerformAuthenticationURL
ÚÚ *
.
ÚÚ* +
Trim
ÚÚ+ /
(
ÚÚ/ 0
$char
ÚÚ0 3
)
ÚÚ3 4
;
ÚÚ4 5,
openIDPerformAuthenticationURL
ÛÛ *
+=
ÛÛ+ -
$str
ÛÛ. =
;
ÛÛ= >,
openIDPerformAuthenticationURL
ÙÙ *
+=
ÙÙ+ -
$str
ÙÙ. :
+
ÙÙ; <
client
ÙÙ= C
;
ÙÙC D,
openIDPerformAuthenticationURL
ıı *
+=
ıı+ -
$str
ıı. F
+
ııG H
scope
ııI N
;
ııN O,
openIDPerformAuthenticationURL
ˆˆ *
+=
ˆˆ+ -
$str
ˆˆ. >
+
ˆˆ? @
redirectURL
ˆˆA L
;
ˆˆL M,
openIDPerformAuthenticationURL
˜˜ *
+=
˜˜+ -
$str
˜˜. C
;
˜˜C D,
openIDPerformAuthenticationURL
¯¯ *
+=
¯¯+ -
$str
¯¯. <
+
¯¯= >
locales
¯¯? F
;
¯¯F G,
openIDPerformAuthenticationURL
˘˘ *
+=
˘˘+ -
$str
˘˘. 7
+
˘˘8 9
state
˘˘: ?
;
˘˘? @
return
˚˚ ,
openIDPerformAuthenticationURL
˚˚ 1
;
˚˚1 2
}
¸¸ 	
public
˛˛ 
HttpStatusCode
˛˛ 

RevokToken
˛˛ (
(
˛˛( )
string
˛˛) /
token
˛˛0 5
)
˛˛5 6
{
ˇˇ 	
string
ÅÅ !
revocation_endpoint
ÅÅ &
=
ÅÅ' (
$str
ÅÅ) T
;
ÅÅT U
HttpClientHandler
ÇÇ 
handler
ÇÇ %
=
ÇÇ& '
new
ÇÇ( +
HttpClientHandler
ÇÇ, =
(
ÇÇ= >
)
ÇÇ> ?
;
ÇÇ? @

HttpClient
ÉÉ 
client
ÉÉ 
=
ÉÉ 
new
ÉÉ  #

HttpClient
ÉÉ$ .
(
ÉÉ. /
handler
ÉÉ/ 6
)
ÉÉ6 7
;
ÉÉ7 8
string
ÖÖ 
	client_id
ÖÖ 
=
ÖÖ 
$str
ÖÖ E
;
ÖÖE F
string
ÜÜ 
client_secret
ÜÜ  
=
ÜÜ! "
	GetSecret
ÜÜ# ,
(
ÜÜ, -
)
ÜÜ- .
;
ÜÜ. /
string
àà 

basicToken
àà 
=
àà 
	client_id
àà  )
+
àà* +
$str
àà, /
+
àà0 1
client_secret
àà2 ?
;
àà@ A
var
ââ 

basicBytes
ââ 
=
ââ 
System
ââ #
.
ââ# $
Text
ââ$ (
.
ââ( )
Encoding
ââ) 1
.
ââ1 2
UTF8
ââ2 6
.
ââ6 7
GetBytes
ââ7 ?
(
ââ? @

basicToken
ââ@ J
)
ââJ K
;
ââK L
string
ää 
basic
ää 
=
ää 
Convert
ää "
.
ää" #
ToBase64String
ää# 1
(
ää1 2

basicBytes
ää2 <
)
ää< =
;
ää= >
client
ãã 
.
ãã #
DefaultRequestHeaders
ãã (
.
ãã( )
Authorization
ãã) 6
=
ãã7 8
new
ãã9 <
System
ãã= C
.
ããC D
Net
ããD G
.
ããG H
Http
ããH L
.
ããL M
Headers
ããM T
.
ããT U'
AuthenticationHeaderValue
ããU n
(
ããn o
$str
ãão v
,
ããv w
basic
ããx }
)
ãã} ~
;
ãã~ 
client
çç 
.
çç #
DefaultRequestHeaders
çç (
.
çç( )
Accept
çç) /
.
çç/ 0
Add
çç0 3
(
çç3 4
new
çç4 7
System
çç8 >
.
çç> ?
Net
çç? B
.
ççB C
Http
ççC G
.
ççG H
Headers
ççH O
.
ççO P-
MediaTypeWithQualityHeaderValue
ççP o
(
çço p
$str
ççp u
)
ççu v
)
ççv w
;
ççw x
string
ëë  
exchangeParameters
ëë %
=
ëë& '
$str
ëë( *
;
ëë* + 
exchangeParameters
íí 
+=
íí !
HttpUtility
íí" -
.
íí- .
	UrlEncode
íí. 7
(
íí7 8
$str
íí8 I
)
ííI J
+
ííK L
$str
ííM P
+
ííQ R
HttpUtility
ííS ^
.
íí^ _
	UrlEncode
íí_ h
(
ííh i
$str
ííi q
)
ííq r
;
íír s 
exchangeParameters
ìì 
+=
ìì !
$str
ìì" %
;
ìì% & 
exchangeParameters
ïï 
+=
ïï !
HttpUtility
ïï" -
.
ïï- .
	UrlEncode
ïï. 7
(
ïï7 8
$str
ïï8 ?
)
ïï? @
+
ïïA B
$str
ïïC F
+
ïïG H
HttpUtility
ïïI T
.
ïïT U
	UrlEncode
ïïU ^
(
ïï^ _
token
ïï_ d
)
ïïd e
;
ïïe f 
HttpRequestMessage
óó 
request
óó &
=
óó' (
new
óó) , 
HttpRequestMessage
óó- ?
(
óó? @

HttpMethod
óó@ J
.
óóJ K
Post
óóK O
,
óóO P!
revocation_endpoint
óóQ d
)
óód e
;
óóe f
request
òò 
.
òò 
Content
òò 
=
òò 
new
òò !
StringContent
òò" /
(
òò/ 0 
exchangeParameters
òò0 B
,
òòB C
System
òòD J
.
òòJ K
Text
òòK O
.
òòO P
Encoding
òòP X
.
òòX Y
UTF8
òòY ]
,
òò] ^
$stròò_ Ñ
)òòÑ Ö
;òòÖ Ü!
HttpResponseMessage
öö 
response
öö  (
=
öö) *
client
öö+ 1
.
öö1 2
	SendAsync
öö2 ;
(
öö; <
request
öö< C
)
ööC D
.
ööD E
Result
ööE K
;
ööK L
if
õõ 
(
õõ 
response
õõ 
.
õõ 

StatusCode
õõ #
!=
õõ$ &
System
õõ' -
.
õõ- .
Net
õõ. 1
.
õõ1 2
HttpStatusCode
õõ2 @
.
õõ@ A
OK
õõA C
)
õõC D
{
úú 
}
°° 
return
§§ 
response
§§ 
.
§§ 

StatusCode
§§ &
;
§§& '
}
•• 	
public
ßß 
string
ßß 
	GetSecret
ßß 
(
ßß  
)
ßß  !
{
®® 	
return
©©
 
_config
©© 
.
©© !
GetConnectionString
©© -
(
©©- .
$str
©©. 6
)
©©6 7
;
©©7 8
}
™™ 	
}
´´ 
}¨¨ ˘
dC:\Users\ITAdministrator\source\repos\B3G.DGSN\B3G.DGSN.SERVICE\ImplemetInterface\SessionServices.cs
	namespace 	
B3G
 
. 
DGSN 
. 
SERVICE 
. 
ImplemetInterface ,
{ 
public 

class 
SessionServices  
:! "
ISessionService# 2
{ 
private 
IGeneriqueCRUD 
< 
Session &
>& '
_repo( -
;- .
public 
SessionServices 
( 
IGeneriqueCRUD -
<- .
Session. 5
>5 6
CrudMethodes7 C
)C D
{ 	
_repo 
= 
CrudMethodes  
;  !
} 	
public 
void 

AddSession 
( 
Session &
session' .
). /
{ 	
if 
( 
session 
!= 
null 
)  
{ 
_repo 
. 
Add 
( 
session !
)! "
;" #
}!! 
}"" 	
public$$ 
bool$$ 
IsSessionExist$$ "
($$" #
string$$# )
id$$* ,
)$$, -
=>$$. 0
_repo$$1 6
.$$6 7
isSessionExist$$7 E
($$E F
id$$F H
)$$H I
;$$I J
}'' 
}(( á
WC:\Users\ITAdministrator\source\repos\B3G.DGSN\B3G.DGSN.SERVICE\INTERFACES\IDGSNFunc.cs
	namespace 	
B3G
 
. 
DGSN 
. 
SERVICE 
. 

INTERFACES %
{		 
public

 

	interface

 
	IDGSNFunc

 
{ 
public 
string 
	GetSecret 
(  
)  !
;! "
public 
string 
VerifierSignature '
(' (
string( .
token/ 4
,4 5
string6 <
JwksURL= D
)D E
;E F
public 
string 
GetToken 
( 
string %
code& *
)* +
;+ ,
public 
string 
SendUserToDGSN $
($ %
)% &
;& '
public 
string 
RedirectUrl !
(! "
string" (
code) -
,- .
string. 4
state5 :
,: ;
string; A
	codeErrorB K
,K L
stringL R
ErrorDescriptionS c
)c d
;d e
public 
HttpStatusCode 

RevokToken (
(( )
string) /
token0 5
)5 6
;6 7
} 
} ô
]C:\Users\ITAdministrator\source\repos\B3G.DGSN\B3G.DGSN.SERVICE\INTERFACES\ISessionService.cs
	namespace 	
B3G
 
. 
DGSN 
. 
SERVICE 
. 

INTERFACES %
{		 
public

 

	interface

 
ISessionService

 $
{ 
public 
void 

AddSession 
( 
Session &
session' .
). /
;/ 0
public 
bool 
IsSessionExist "
(" #
string# )
id* ,
), -
;- .
} 
} 